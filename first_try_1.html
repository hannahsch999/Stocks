<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Stock Price Estimator</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(120deg, #f8e3f0 0%, #d1e3ff 100%);
      color: #333;
      margin: 0; padding: 0;
    }
    header {
      padding: 20px; text-align: center;
      background: linear-gradient(90deg, #e8a9d6 20%, #b3cfff 80%);
      color: #4c3273;
      font-size: 2em; font-weight: 700;
      letter-spacing: 2px;
    }
    .filters {
      display: flex; flex-wrap: wrap;
      gap: 14px; padding: 24px; justify-content: center;
      background: #fff2fa; border-bottom: 2px solid #f3c9e7;
    }
    .filter-group {
      display: flex; flex-direction: column;
      background: #fed6ff; border-radius: 12px; padding: 12px;
      min-width: 160px;
    }
    .pink-btn {
      background: linear-gradient(90deg, #e8a9d6, #b3cfff);
      border: none; border-radius: 20px;
      padding: 12px 32px; margin: 20px 0;
      color: #4c3273; font-weight: bold; cursor: pointer;
      box-shadow: 2px 4px 16px #e8a9d6AA;
      transition: background 0.3s;
    }
    .pink-btn:hover {
      background: linear-gradient(100deg, #f3c9e7 20%, #b3d6ff 80%);
    }
    .results {
      max-width: 950px; margin: 26px auto 0 auto; padding: 20px;
      background: #fff6fa; border-radius: 18px; box-shadow: 0 6px 24px #f8e3f088;
    }
    .cards {
      display: flex; flex-wrap: wrap; gap: 16px; justify-content: center; margin-bottom: 24px;
    }
    .stock-card {
      background: linear-gradient(90deg, #fed6ff, #e0ecff);
      border-radius: 16px; min-width: 220px; padding: 18px;
      box-shadow: 0 2px 8px #e8a9d6AA;
      cursor: pointer; transition: box-shadow 0.4s;
    }
    .stock-card:hover { box-shadow: 0 6px 24px #d1e3ffCC; }
    footer {background:#f8e3f0;padding:18px 0;text-align:center; color:#807ca5;}
    .modal {
      display: none; position: fixed; z-index: 2000;
      left: 0; top: 0; right:0; bottom:0;
      width:100%;height:100%;justify-content:center;align-items:center;background:#0006;
    }
    .modal-content {
      background:#fff; padding:32px 24px; border-radius:18px;
      max-width: 550px; margin:auto;
    }
    .close-btn {
      float:right; font-size:20px; font-weight:bold; color:#e8a9d6;
      cursor:pointer; margin:-24px -12px 0 0;
    }
    .chart-section { margin-bottom: 36px; }
    @media (max-width:900px){.cards{flex-direction:column;align-items:center;}}
  </style>
</head>
<body>
  <header>
    AI Stock Price Estimator
  </header>
  <div class="filters">
    <div class="filter-group">
      <label for="region">Region</label>
      <select id="region" multiple style="height:90px">
        <option value="USA">USA</option>
        <option value="Europe">Europe</option>
        <option value="China">China</option>
        <option value="Africa">Africa/Emerging</option>
        <option value="Global">Global</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="sector">Sector</label>
      <select id="sector" multiple style="height:90px">
        <option value="Technology">Technology</option>
        <option value="Healthcare">Healthcare</option>
        <option value="Finance">Finance</option>
        <option value="Consumer Discretionary">Consumer Discretionary</option>
        <option value="Energy">Energy</option>
        <option value="Industrials">Industrials</option>
        <option value="Utilities">Utilities</option>
        <option value="Real Estate">Real Estate</option>
        <option value="Materials">Materials</option>
        <option value="Communication Services">Communication Services</option>
        <option value="Consumer Staples">Consumer Staples</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="industry">Industry</label>
      <select id="industry" multiple style="height:90px">
        <option value="Biotech">Biotech</option>
        <option value="Pharmaceuticals">Pharmaceuticals</option>
        <option value="Software">Software</option>
        <option value="Semiconductors">Semiconductors</option>
        <option value="Retail">Retail</option>
        <option value="Banks">Banks</option>
        <option value="Insurance">Insurance</option>
        <option value="Oil & Gas">Oil & Gas</option>
        <option value="Utilities">Utilities</option>
        <option value="Telecom">Telecom</option>
        <option value="Food & Beverage">Food & Beverage</option>
        <option value="Automotive">Automotive</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="risk">Risk Level</label>
      <select id="risk" multiple style="height:90px">
        <option value="Low">Low Risk (Large-cap, ETF)</option>
        <option value="Medium">Medium Risk</option>
        <option value="High">High Risk</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="volatility">Volatility / Return</label>
      <select id="volatility" multiple style="height:90px">
        <option value="Stable">Stable (ETF)</option>
        <option value="Growth">Growth Stocks</option>
        <option value="Speculative">Speculative/Crypto</option>
      </select>
    </div>
    <button class="pink-btn" onclick="getEstimates()">Get Stock Estimates</button>
  </div>
  <div class="results" id="results" style="display:none">
    <h2>Top Matching Assets</h2>
    <div class="cards" id="assetCards"></div>
    <div class="chart-section">
      <h3>Portfolio Trend (Average of Selection)</h3>
      <canvas id="portfolioChart" width="900" height="380"></canvas>
    </div>
    <button class="pink-btn" onclick="resetFilters()">Select Another Stock</button>
    <button class="pink-btn" onclick="showModal('aiModal')">About AI Predictions</button>
    <button class="pink-btn" onclick="showModal('helpModal')">Help</button>
  </div>

  <!-- Modals -->
  <div class="modal" id="stockModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('stockModal')">&times;</span>
      <div id="stockModalContent"></div>
    </div>
  </div>
  <div class="modal" id="aiModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('aiModal')">&times;</span>
      <h3>About AI Predictions</h3>
      <p>
        This website uses up-to-date market data and simple AI/algorithmic forecasts. The predictions are based on historical price patterns and trend extrapolation. For advanced users, we recommend more professional tools. Please note: predictions are for educational purposes only; past performance is not indicative of future results.
      </p>
    </div>
  </div>
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal('helpModal')">&times;</span>
      <h3>How to Use This Website & Investing Tips</h3>
      <ol>
        <li>Diversify your investmentsâ€”don't put all your money in one stock.</li>
        <li>Understand your risk tolerance before investing.</li>
        <li>Large companies and ETFs are usually less volatile than individual stocks or crypto.</li>
        <li>Higher returns often mean higher risk.</li>
        <li>Use filters to find assets that fit your risk and region preferences.</li>
        <li>Always check recent news that might affect asset performance.</li>
        <li>Past performance does not guarantee future results.</li>
        <li>Consider starting with small investments and learning over time.</li>
        <li>Regularly review your portfolio and rebalance as needed.</li>
        <li>Never invest money you can't afford to lose.</li>
      </ol>
      <hr>
      <b>FAQs:</b>
      <ul>
        <li><b>How does prediction work?</b> AI forecast uses market data trends and extrapolation.</li>
        <li><b>What is an ETF?</b> An ETF is a collection of securities you can buy like a stock.</li>
        <li><b>How do I pick a region/sector?</b> Use filters to match assets with your interests and knowledge.</li>
      </ul>
    </div>
  </div>

  <footer>Site for finance beginners &mdash; Investing can be fun and easy!</footer>

<script>
    // --- Step 1: Configuration ---
    // PASTE YOUR FINANCIAL MODELING PREP API KEY HERE
    const apiKey = 'KXV72OK74LH07YPF';

    // This array will hold all the assets we fetch from the API
    let allAssets = [];

    // --- Step 2: Load All Asset Lists When the Page Opens ---
    // This function runs automatically as soon as the webpage is loaded.
    window.onload = async function() {
        console.log("Loading initial asset data from FMP API...");
        // Show a temporary loading message to the user
        const assetCards = document.getElementById('assetCards');
        assetCards.innerHTML = '<p>Loading asset database... please wait.</p>';

        try {
            // Define API endpoints for different asset types
            const sp500Url = `https://financialmodelingprep.com/api/v3/sp500_constituent?apikey=${apiKey}`;
            const etfUrl = `https://financialmodelingprep.com/api/v3/etf/list?apikey=${apiKey}`;
            const cryptoUrl = `https://financialmodelingprep.com/api/v3/crypto/list?apikey=${apiKey}`;

            // Fetch all data in parallel for speed
            const [sp500Response, etfResponse, cryptoResponse] = await Promise.all([
                fetch(sp500Url),
                fetch(etfUrl),
                fetch(cryptoUrl)
            ]);

            const sp500Data = await sp500Response.json();
            const etfData = await etfResponse.json();
            const cryptoData = await cryptoResponse.json();

            // Process and format the data to match our application's structure
            const processedSP500 = sp500Data.map(stock => ({
                ticker: stock.symbol,
                name: stock.name,
                sector: stock.sector || 'N/A',
                industry: stock.subSector || 'N/A',
                region: 'USA',
                risk: 'Medium', // Assigning default risk/volatility
                volatility: 'Growth'
            }));

            const processedETFs = etfData.slice(0, 100).map(etf => ({
                ticker: etf.symbol,
                name: etf.name,
                sector: 'ETF',
                industry: 'ETF',
                region: 'Global',
                risk: 'Low',
                volatility: 'Stable'
            }));

            const processedCrypto = cryptoData.slice(0, 50).map(crypto => ({
                ticker: crypto.symbol,
                name: crypto.name,
                sector: 'Crypto',
                industry: 'Crypto',
                region: 'Global',
                risk: 'High',
                volatility: 'Speculative'
            }));

            // Combine all assets into our global array
            allAssets = [...processedSP500, ...processedETFs, ...processedCrypto];
            console.log(`Successfully loaded ${allAssets.length} assets!`);
            assetCards.innerHTML = '<p>Asset database loaded. Please use the filters above.</p>';

        } catch (error) {
            console.error("Failed to load initial asset data:", error);
            assetCards.innerHTML = '<p style="color: red;">Error: Could not load asset data from the API. Please check your API key or network connection.</p>';
        }
    };


    // --- Step 3: Filtering and Displaying Results ---
    // This function runs when you click "Get Stock Estimates"
    function getEstimates() {
        const regionVals = Array.from(document.getElementById('region').selectedOptions).map(o => o.value);
        const sectorVals = Array.from(document.getElementById('sector').selectedOptions).map(o => o.value);
        const industryVals = Array.from(document.getElementById('industry').selectedOptions).map(o => o.value);
        const riskVals = Array.from(document.getElementById('risk').selectedOptions).map(o => o.value);
        const volVals = Array.from(document.getElementById('volatility').selectedOptions).map(o => o.value);

        // IMPORTANT: We now filter the 'allAssets' array fetched from the API
        let match = allAssets.filter(a =>
            (regionVals.length === 0 || regionVals.includes(a.region)) &&
            (sectorVals.length === 0 || sectorVals.includes(a.sector)) &&
            (industryVals.length === 0 || industryVals.includes(a.industry)) &&
            (riskVals.length === 0 || riskVals.includes(a.risk)) &&
            (volVals.length === 0 || volVals.includes(a.volatility))
        );

        // Display the top 6 matches
        const topMatches = match.slice(0, 6);
        document.getElementById('results').style.display = 'block';
        const assetCards = document.getElementById('assetCards');
        assetCards.innerHTML = '';

        if (topMatches.length === 0) {
            assetCards.innerHTML = "<p>No assets match your criteria. Try broadening your search!</p>";
            drawPortfolioChart([]); // Clear chart
            return;
        }

        topMatches.forEach(asset => {
            let card = document.createElement('div');
            card.classList.add('stock-card');
            card.innerHTML = `<b>${asset.name} <span style='font-size:0.8em;color:#4c3273;'>(${asset.ticker})</span></b><br>
                <small>Sector: ${asset.sector}</small><br>
                <span>Risk: ${asset.risk}</span><br>
                <button class='pink-btn' style='margin:10px 0 0 0;padding:8px 18px;font-size:0.9em;' onclick="showStock('${asset.ticker}')">See Performance</button>`;
            assetCards.appendChild(card);
        });

        // We can't draw the portfolio chart yet because we don't have price data.
        // For simplicity, we will skip drawing it for now, or fetch all prices (can be slow).
        document.getElementById('portfolioChart').style.display = 'none'; // Hide portfolio chart for now
    }


    // --- Step 4: Displaying a Single Stock's Details and Price Chart ---
    // This function runs when you click "See Performance" on a card
    async function showStock(ticker) {
        const assetInfo = allAssets.find(a => a.ticker === ticker);
        if (!assetInfo) return;

        const modalContent = document.getElementById('stockModalContent');
        modalContent.innerHTML = `<p>Loading price history for ${ticker}...</p>`;
        showModal('stockModal');

        // Fetch the 30-day price history for this specific asset
        const historyUrl = `https://financialmodelingprep.com/api/v3/historical-price-full/${ticker}?timeseries=30&apikey=${apiKey}`;

        try {
            const response = await fetch(historyUrl);
            const data = await response.json();

            if (!data.historical || data.historical.length === 0) {
                 modalContent.innerHTML = `<p>Sorry, price history is not available for ${ticker}.</p>`;
                 return;
            }

            // Extract closing prices and reverse to have oldest first
            const prices = data.historical.map(day => day.close).reverse();
            const latestPrice = prices[prices.length - 1];
            const simpleReturn = (latestPrice - prices[0]) / prices[0];
            const trend = simpleReturn > 0.05 ? "Strong upward trend" : simpleReturn > 0 ? "Mild upward trend" : "Stable or downtrend";

            // Populate the modal with the fetched data
            modalContent.innerHTML = `<h3>${assetInfo.name} (${assetInfo.ticker})</h3>
                <p><b>Sector:</b> ${assetInfo.sector} | <b>Region:</b> ${assetInfo.region} | <b>Risk:</b> ${assetInfo.risk}</p>
                <p><b>Latest Price:</b> ${latestPrice.toLocaleString('en-US', { style: 'currency', currency: 'USD' })}</p>
                <p><b>30-Day Trend Summary:</b> ${trend}</p>
                <canvas id="stockChart" width="430" height="180"></canvas>`;

            // Draw the chart inside the modal
            setTimeout(() => drawStockChart(prices), 100);

        } catch (error) {
            console.error(`Failed to fetch history for ${ticker}:`, error);
            modalContent.innerHTML = `<p style="color:red;">Could not load price history for ${ticker}.</p>`;
        }
    }

    // --- Step 5: Utility and Drawing Functions (Mostly Unchanged) ---

    // Draws the chart for a single stock inside the modal
    function drawStockChart(prices) {
        const ctx = document.getElementById('stockChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({ length: prices.length }, (_, i) => `Day ${i + 1}`),
                datasets: [{
                    label: 'Price (USD)', data: prices,
                    backgroundColor: '#e8a9d655', borderColor: '#e8a9d6', borderWidth: 3
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });
    }

    // This function is no longer used in the main workflow but kept for reference
    function drawPortfolioChart(matches) {
        // This would require fetching prices for all 'matches', which can be slow.
        // For now, it's disabled.
    }

    function resetFilters() {
        document.getElementById('results').style.display = 'none';
        // Clear selections if needed
        document.querySelectorAll('.filters select').forEach(s => s.selectedIndex = -1);
    }
    function showModal(id) { document.getElementById(id).style.display = "flex"; }
    function closeModal(id) { document.getElementById(id).style.display = "none"; }
</script>


</body>
</html>
